============================= test session starts ==============================
platform darwin -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /Users/annhoward/src/solarpunk_utopia
plugins: anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 295 items

tests/e2e/test_ancestor_voting_e2e.py ...........                        [  3%]
tests/e2e/test_bakunin_analytics_e2e.py ......                           [  5%]
tests/e2e/test_blocking_silent_failure_e2e.py ..........                 [  9%]
tests/e2e/test_cross_community_discovery_e2e.py ...........              [ 12%]
tests/e2e/test_dtn_mesh_sync_e2e.py .........                            [ 15%]
tests/e2e/test_governance_complete_flow.py .                             [ 16%]
tests/e2e/test_governance_e2e.py ..........                              [ 19%]
tests/e2e/test_mycelial_strike_e2e.py .........F                         [ 23%]
tests/e2e/test_rapid_response_e2e.py FFFFFF                              [ 25%]
tests/e2e/test_sanctuary_network_e2e.py ......                           [ 27%]
tests/e2e/test_saturnalia_e2e.py ..............                          [ 31%]
tests/e2e/test_web_of_trust_e2e.py ..........                            [ 35%]
tests/integration/test_end_to_end_gift_economy.py FFF                    [ 36%]
tests/integration/test_knowledge_distribution.py FF                      [ 36%]
tests/test_algorithmic_transparency.py .............                     [ 41%]
tests/test_api_endpoint_fixes.py ..FF..........F.                        [ 46%]
tests/test_care_outreach.py ............                                 [ 50%]
tests/test_economic_withdrawal.py ........                               [ 53%]
tests/test_fork_rights.py ..........F.                                   [ 57%]
tests/test_fraud_abuse_protections.py ........F.F.                       [ 61%]
tests/test_governance_silence_weight.py ...............F....             [ 68%]
tests/test_harness.py .........FFFFF...F.....                            [ 76%]
tests/test_network_import_offline.py ........                            [ 78%]
tests/test_panic_features.py ..............                              [ 83%]
tests/test_sanctuary_multi_steward_verification.py ......FF..........    [ 89%]
tests/unit/test_bundle_service.py FFFFFFFFF.FFFF..                       [ 95%]
tests/unit/test_web_of_trust.py ..............                           [100%]

=================================== FAILURES ===================================
E   AssertionError: assert FakeDatetime(2025, 1, 8, 0, 0, tzinfo=datetime.timezone.utc) == FakeDatetime(2025, 1, 8, 0, 0)
     +  where FakeDatetime(2025, 1, 8, 0, 0, tzinfo=datetime.timezone.utc) = WarlordAlert(id='6eefd94e-dcc7-49e1-8dc4-716fcf588ee1', target_user_id='bob', severity=6, abuse_type=<AbuseType.BATTER...sted_source=True, propagation_count=0, cancelled=False, cancelled_by=None, cancellation_reason=None, cancelled_at=None).expires_at
     +  and   FakeDatetime(2025, 1, 8, 0, 0) = datetime(2025, 1, 8, 0, 0, 0)
/Users/annhoward/src/solarpunk_utopia/tests/e2e/test_mycelial_strike_e2e.py:558: AssertionError: assert FakeDatetime(2025, 1, 8, 0, 0, tzinfo=datetime.timezone.utc) == FakeDatetime(2025, 1, 8, 0, 0)
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   httpcore.ConnectError: All connection attempts failed

The above exception was the direct cause of the following exception:
E   httpx.ConnectError: All connection attempts failed
----------------------------- Captured stdout call -----------------------------

=== Step 1: Creating agents ===
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/httpx/_transports/default.py:118: httpx.ConnectError: All connection attempts failed
E   assert 500 == 200
     +  where 500 = <Response [500 Internal Server Error]>.status_code
----------------------------- Captured stdout call -----------------------------

=== Testing Bundle Propagation ===
/Users/annhoward/src/solarpunk_utopia/tests/integration/test_end_to_end_gift_economy.py:266: assert 500 == 200
E   assert 500 == 200
     +  where 500 = <Response [500 Internal Server Error]>.status_code
----------------------------- Captured stdout call -----------------------------

=== Testing Agent Approval Gates ===
/Users/annhoward/src/solarpunk_utopia/tests/integration/test_end_to_end_gift_economy.py:309: assert 500 == 200
E   assert 500 == 200
     +  where 500 = <Response [500 Internal Server Error]>.status_code
----------------------------- Captured stdout call -----------------------------

=== Step 1: Creating test file ===
Created test file: 8750 bytes

=== Step 2: Uploading file ===
/Users/annhoward/src/solarpunk_utopia/tests/integration/test_knowledge_distribution.py:66: assert 500 == 200
E   KeyError: 'cache_size_bytes'
----------------------------- Captured stdout call -----------------------------

=== Testing Library Node Caching ===
/Users/annhoward/src/solarpunk_utopia/tests/integration/test_knowledge_distribution.py:190: KeyError: 'cache_size_bytes'
E   AttributeError: 'str' object has no attribute 'value'

During handling of the above exception, another exception occurred:
E   fastapi.exceptions.HTTPException: 400: 'str' object has no attribute 'value'
/Users/annhoward/src/solarpunk_utopia/valueflows_node/app/api/vf/matches.py:176: fastapi.exceptions.HTTPException: 400: 'str' object has no attribute 'value'
E   AttributeError: 'str' object has no attribute 'value'

During handling of the above exception, another exception occurred:
E   fastapi.exceptions.HTTPException: 400: 'str' object has no attribute 'value'
/Users/annhoward/src/solarpunk_utopia/valueflows_node/app/api/vf/matches.py:210: fastapi.exceptions.HTTPException: 400: 'str' object has no attribute 'value'
E   AssertionError: Should NOT use request.user_id
    assert 'request.user_id' not in '@router.pos...il=str(e))\n'
      
      'request.user_id' is contained here:
        nstead of request.user_id
            """
            try:
                proposal = await approval_tracker.approve_proposal(
                    proposal_id=proposal_id,...
      
      ...Full output truncated (9 lines hidden), use '-vv' to show
/Users/annhoward/src/solarpunk_utopia/tests/test_api_endpoint_fixes.py:235: AssertionError: Should NOT use request.user_id
E   sqlite3.OperationalError: unable to open database file
/Users/annhoward/src/solarpunk_utopia/app/services/fork_rights_service.py:170: sqlite3.OperationalError: unable to open database file
E   AssertionError: assert False == True
     +  where False = SanctuaryVerification(resource_id='space_001', verifications=[], first_verified_at=None, last_check=None, expires_at=None, successful_uses=0).is_valid
/Users/annhoward/src/solarpunk_utopia/tests/test_fraud_abuse_protections.py:209: AssertionError: assert False == True
E   AssertionError: assert False == True
     +  where False = SanctuaryVerification(resource_id='space_001', verifications=[], first_verified_at=None, last_check=None, expires_at=None, successful_uses=3).is_high_trust
/Users/annhoward/src/solarpunk_utopia/tests/test_fraud_abuse_protections.py:242: AssertionError: assert False == True
E   assert None is not None
/Users/annhoward/src/solarpunk_utopia/tests/test_governance_silence_weight.py:379: assert None is not None
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'

During handling of the above exception, another exception occurred:
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
/opt/homebrew/Cellar/python@3.12/3.12.12/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1603: TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'

During handling of the above exception, another exception occurred:
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
/opt/homebrew/Cellar/python@3.12/3.12.12/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1603: TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'

During handling of the above exception, another exception occurred:
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
/opt/homebrew/Cellar/python@3.12/3.12.12/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1603: TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'

During handling of the above exception, another exception occurred:
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
/opt/homebrew/Cellar/python@3.12/3.12.12/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1603: TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'

During handling of the above exception, another exception occurred:
E   TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
/opt/homebrew/Cellar/python@3.12/3.12.12/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1603: TypeError: cannot set 'now' attribute of immutable type 'datetime.datetime'
E   AssertionError: assert 1.0 == 0.0
     +  where 1.0 = get_trust('bob')
     +    where get_trust = <tests.harness.trust_fixtures.TrustGraphFixture object at 0x10b888ce0>.get_trust
/Users/annhoward/src/solarpunk_utopia/tests/test_harness.py:313: AssertionError: assert 1.0 == 0.0
E   NameError: name 'timedelta' is not defined
/Users/annhoward/src/solarpunk_utopia/app/database/sanctuary_repository.py:907: NameError: name 'timedelta' is not defined
E   NameError: name 'timedelta' is not defined
/Users/annhoward/src/solarpunk_utopia/app/database/sanctuary_repository.py:907: NameError: name 'timedelta' is not defined
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
E   sqlite3.OperationalError: attempt to write a readonly database
/Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/aiosqlite/core.py:115: sqlite3.OperationalError: attempt to write a readonly database
=============================== warnings summary ===============================
venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:295: 39 warnings
tests/test_api_endpoint_fixes.py: 12 warnings
  /Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/e2e/test_rapid_response_e2e.py: 6 warnings
tests/e2e/test_sanctuary_network_e2e.py: 28 warnings
tests/test_sanctuary_multi_steward_verification.py: 73 warnings
  /Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/pydantic/main.py:214: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

tests/test_api_endpoint_fixes.py::TestProposalRejection::test_reject_proposal_has_auth_dependency
tests/test_api_endpoint_fixes.py::TestProposalRejection::test_reject_proposal_has_auth_dependency
tests/test_api_endpoint_fixes.py::test_commitments_router_registered
tests/test_api_endpoint_fixes.py::test_commitments_router_registered
  /Users/annhoward/src/solarpunk_utopia/venv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:297: PydanticDeprecatedSince20: `json_encoders` is deprecated. See https://docs.pydantic.dev/2.10/concepts/serialization/#custom-serializers for alternatives. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
    warnings.warn(

tests/test_governance_silence_weight.py::TestPrivacyGuarantees::test_silent_voters_computed_not_stored
  tests/test_governance_silence_weight.py:415: PytestWarning: The test <Function test_silent_voters_computed_not_stored> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    def test_silent_voters_computed_not_stored(self):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/e2e/test_mycelial_strike_e2e.py::TestMycelialStrikeE2E::test_time_based_alert_expiration
FAILED tests/e2e/test_rapid_response_e2e.py::TestRapidResponseE2E::test_full_rapid_response_flow
FAILED tests/e2e/test_rapid_response_e2e.py::TestRapidResponseE2E::test_critical_alert_requires_high_trust
FAILED tests/e2e/test_rapid_response_e2e.py::TestRapidResponseE2E::test_critical_alert_auto_downgrade_if_unconfirmed
FAILED tests/e2e/test_rapid_response_e2e.py::TestRapidResponseE2E::test_alert_propagation_priority
FAILED tests/e2e/test_rapid_response_e2e.py::TestRapidResponseE2E::test_alert_purge_after_24_hours
FAILED tests/e2e/test_rapid_response_e2e.py::TestRapidResponseE2E::test_responder_coordination_flow
FAILED tests/integration/test_end_to_end_gift_economy.py::TestGiftEconomyFlow::test_complete_offer_need_exchange_flow
FAILED tests/integration/test_end_to_end_gift_economy.py::TestGiftEconomyFlow::test_bundle_propagation_across_services
FAILED tests/integration/test_end_to_end_gift_economy.py::TestGiftEconomyFlow::test_agent_proposals_require_approval
FAILED tests/integration/test_knowledge_distribution.py::TestKnowledgeDistribution::test_complete_file_distribution_flow
FAILED tests/integration/test_knowledge_distribution.py::TestKnowledgeDistribution::test_library_node_caching
FAILED tests/test_api_endpoint_fixes.py::TestMatchAcceptReject::test_accept_match_updates_status
FAILED tests/test_api_endpoint_fixes.py::TestMatchAcceptReject::test_reject_match_updates_status
FAILED tests/test_api_endpoint_fixes.py::TestProposalRejection::test_reject_proposal_uses_current_user_id
FAILED tests/test_fork_rights.py::test_local_first_export - sqlite3.Operation...
FAILED tests/test_fraud_abuse_protections.py::TestSanctuaryVerification::test_verification_valid_with_min_stewards
FAILED tests/test_fraud_abuse_protections.py::TestSanctuaryVerification::test_high_trust_requires_successful_uses
FAILED tests/test_governance_silence_weight.py::TestGovernanceRepository::test_outreach_ephemeral
FAILED tests/test_harness.py::TestTimeControl::test_freeze_time - TypeError: ...
FAILED tests/test_harness.py::TestTimeControl::test_advance_time - TypeError:...
FAILED tests/test_harness.py::TestTimeControl::test_advance_with_units - Type...
FAILED tests/test_harness.py::TestTimeControl::test_freeze_time_context_manager
FAILED tests/test_harness.py::TestTimeControl::test_advance_time_context_manager
FAILED tests/test_harness.py::TestTrustGraphFixtures::test_revoke_vouch - Ass...
FAILED tests/test_sanctuary_multi_steward_verification.py::TestResourcesNeedingVerification::test_pending_verification_list
FAILED tests/test_sanctuary_multi_steward_verification.py::TestResourcesNeedingVerification::test_pending_excludes_steward_who_verified
FAILED tests/unit/test_bundle_service.py::TestBundleCreation::test_create_simple_bundle
FAILED tests/unit/test_bundle_service.py::TestBundleCreation::test_create_bundle_with_ttl_hours
FAILED tests/unit/test_bundle_service.py::TestBundleCreation::test_create_bundle_auto_ttl
FAILED tests/unit/test_bundle_service.py::TestBundleCreation::test_create_bundle_with_tags
FAILED tests/unit/test_bundle_service.py::TestBundleCreation::test_bundle_id_is_content_addressed
FAILED tests/unit/test_bundle_service.py::TestBundleValidation::test_validate_valid_bundle
FAILED tests/unit/test_bundle_service.py::TestBundleValidation::test_reject_tampered_payload
FAILED tests/unit/test_bundle_service.py::TestBundleValidation::test_reject_expired_bundle
FAILED tests/unit/test_bundle_service.py::TestBundleValidation::test_reject_invalid_signature
FAILED tests/unit/test_bundle_service.py::TestBundleReceiving::test_receive_valid_bundle
FAILED tests/unit/test_bundle_service.py::TestBundleReceiving::test_reject_duplicate_bundle
FAILED tests/unit/test_bundle_service.py::TestBundleReceiving::test_quarantine_invalid_bundle
FAILED tests/unit/test_bundle_service.py::TestBundleProperties::test_bundle_snake_case_aliases
================= 40 failed, 255 passed, 163 warnings in 5.71s =================
